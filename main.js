(()=>{"use strict";var t=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},e=function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-12/cards/".concat(e),{method:"DELETE",headers:{authorization:"9702ad57-d331-4ea7-bb56-285f4950731d"}}).then(t)},n=function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-12/cards/likes/".concat(e),{method:"PUT",headers:{authorization:"9702ad57-d331-4ea7-bb56-285f4950731d"}}).then(t)},o=function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-12/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:"9702ad57-d331-4ea7-bb56-285f4950731d"}}).then(t)};function r(t,r,a,c,i,u){r.deleteCard,a.likeCard;var l=c.handleImageClick,s=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),p=s.querySelector(".card__delete-button"),d=s.querySelector(".card__like-button"),f=s.querySelector(".card__like_amount"),_=s.querySelector(".card__image");return _.src=t.link,_.alt=t.name,s.querySelector(".card__title").textContent=t.name,t.id!==u&&(p.style.display="none"),p.addEventListener("click",(function(){e(t.cardId).then((function(){s.remove()}))})),d.addEventListener("click",(function(){d.classList.contains("card__like-button_is-active")?o(t.cardId).then((function(){d.classList.toggle("card__like-button_is-active"),f.textContent=t.likes})):n(t.cardId).then((function(){d.classList.toggle("card__like-button_is-active"),f.textContent=t.likes}))})),_.addEventListener("click",(function(){l(t,i)})),f.textContent=t.likes,s}function a(t){t.remove()}function c(t){t.classList.toggle("card__like-button_is-active")}function i(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",l)}function u(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",l)}function l(t){var e=document.querySelector(".popup_is-opened");e&&"Escape"===t.key&&u(e)}var s={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var d=document.querySelector(".places__list"),f=document.querySelectorAll(".popup"),_=document.querySelector(".profile__edit-button"),m=document.querySelector(".popup_type_edit"),y=m.querySelector(".popup__button"),v=document.querySelector(".popup_type_image"),h=(v.querySelector(".popup__button"),document.querySelector(".popup_type_new-avatar")),b=h.querySelector(".popup__button"),S=document.querySelector(".profile__add-button"),C=document.querySelector(".popup_type_new-card"),q=(C.querySelector(".popup__button"),document.querySelectorAll(".popup__close")),k=v.querySelector(".popup__image"),E=m.querySelector(".popup__form"),g=h.querySelector(".popup__form"),L=m.querySelector(".popup__input_type_name"),x=m.querySelector(".popup__input_type_description"),A=document.querySelector(".profile__title"),w=document.querySelector(".profile__description"),I=document.querySelector(".profile__image"),T=C.querySelector(".popup__form"),j=C.querySelector(".popup__input_type_card-name"),z=C.querySelector(".popup__input_type_url");function O(t,e){k.src=t.link,k.alt=t.name,e.querySelector(".popup__caption").textContent=t.name,i(e)}Promise.all([fetch("https://mesto.nomoreparties.co/v1/wff-cohort-12/users/me",{method:"GET",headers:{authorization:"9702ad57-d331-4ea7-bb56-285f4950731d"}}).then(t),fetch("https://nomoreparties.co/v1/wff-cohort-12/cards",{headers:{authorization:"9702ad57-d331-4ea7-bb56-285f4950731d"}}).then(t)]).then((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,a,c,i=[],u=!0,l=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=a.call(n)).done)&&(i.push(o.value),i.length!==e);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw r}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return p(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],u=o[1],l=i.name,s=i.about,f=i._id;A.textContent=l,w.textContent=s,I.style.backgroundImage="url(".concat(i.avatar,")"),Array.from(u).forEach((function(t){var e={name:t.name,link:t.link,id:t.owner._id,likes:t.likes.length,cardId:t._id};d.append(r(e,{deleteCard:a},{likeCard:c},{handleImageClick:O},v,f))}))})).catch((function(t){console.log(t)}));_.addEventListener("click",(function(){i(m),L.value=A.textContent,x.value=w.textContent,function(t,e){t.querySelector(e.submitButtonSelector).classList.add(e.inactiveButtonClass),Array.from(t.querySelectorAll(".popup__input_type_error")).forEach((function(t){t.classList.remove(e.errorClass),t.textContent=""})),Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(t){t.classList.remove(e.inputErrorClass)}))}(E,s)})),S.addEventListener("click",(function(){i(C)})),q.forEach((function(t){var e=t.closest(".popup");t.addEventListener("click",(function(){return u(e)}))})),I.addEventListener("click",(function(){i(h)})),f.forEach((function(t){t.addEventListener("click",(function(e){e.target.classList.contains("popup")&&u(t)}))})),E.addEventListener("submit",(function(e){e.preventDefault();var n,o,r=L.value,a=x.value;A.textContent=L.value,w.textContent=x.value,y.textContent="Сохранение...",(n=r,o=a,fetch("https://mesto.nomoreparties.co/v1/wff-cohort-12/users/me",{method:"PATCH",headers:{authorization:"9702ad57-d331-4ea7-bb56-285f4950731d","Content-Type":"application/json"},body:JSON.stringify({name:"".concat(n),about:"".concat(o)})}).then(t)).then((function(t){A.textContent=t.name,w.textContent=t.about,y.textContent="Сохранить"})).catch((function(t){console.log(t),y.textContent="Сохранить"})),u(m)})),T.addEventListener("submit",(function(e){e.preventDefault(),function(e){e.preventDefault();var n=j.value,o=z.value,i={name:n,link:o};C.textContent="Сохранение...",function(e,n){return fetch("https://nomoreparties.co/v1/wff-cohort-12/cards",{method:"POST",headers:{authorization:"9702ad57-d331-4ea7-bb56-285f4950731d","Content-Type":"application/json"},body:JSON.stringify({name:"".concat(e),link:"".concat(n)})}).then(t)}(n,o).then((function(t){C.textContent="Сохранить",i.name=t.name,i.link=t.link,i.profileId=t.owner._id})).catch((function(t){console.log(t)}));var l=r(i,{deleteCard:a},{likeCard:c},{handleImageClick:O});d.prepend(l),T.reset(),u(C)}(e),u(C)})),g.addEventListener("submit",(function(e){(function(e){e.preventDefault();var n,o=h.querySelector(".popup__input_type_url");b.textContent="Сохранение...",(n={avatar:o.value},fetch("https://nomoreparties.co/v1/wff-cohort-12/users/me/avatar",{method:"PATCH",headers:{authorization:"9702ad57-d331-4ea7-bb56-285f4950731d","Content-Type":"application/json"},body:JSON.stringify(n)}).then(t)).then((function(t){I.style.backgroundImage="url(".concat(t.avatar,")"),b.textContent="Сохранить"})).catch((function(t){console.log(t),b.textContent="Сохранить"}))})(e),u(h)})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(".popup__button");n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n.inputErrorClass),r.classList.add(n.errorClass),r.textContent=o}(t,e,n,e.validationMessage)}(t,r,e),function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?e.classList.remove(n.inactiveButtonClass):e.classList.add(n.inactiveButtonClass)}(n,o,e)}))}))}(e,t)}))}(s)})();